{"visual":{"name":"pBIplotly","displayName":"PBI_plotly","guid":"pBIplotlyAFEA9760BDCA4473BEA802445EC7558B","visualClassName":"Visual","version":"1.0.0","description":"","supportUrl":"","gitHubUrl":""},"apiVersion":"2.5.0","author":{"name":"Xiangnan Dang","email":"dang_xiangnan@lilly.com"},"assets":{"icon":"assets/icon.png"},"externalJS":["node_modules/powerbi-visuals-utils-dataviewutils/lib/index.js"],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"x","description":"show on x axis","kind":"GroupingOrMeasure","name":"x"},{"displayName":"y","description":"show on y axis","kind":"GroupingOrMeasure","name":"y"},{"displayName":"y error","description":"show on y error","kind":"GroupingOrMeasure","name":"yerror"},{"displayName":"color","description":"color","kind":"GroupingOrMeasure","name":"color"},{"displayName":"facet_row","description":"row for facet_grid","kind":"Grouping","name":"facet_row"},{"displayName":"facet_col","description":"column for facet_grid","kind":"Grouping","name":"facet_col"},{"displayName":"Tooltips","description":"Fields to be used as mouseover tooltips","kind":"Grouping","name":"tooltips"}],"dataViewMappings":[{"conditions":[{"x":{"max":1},"y":{"max":1},"tooltips":{"max":7}}],"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"x"}},{"for":{"in":"y"}},{"for":{"in":"color"}},{"for":{"in":"facet_row"}},{"for":{"in":"facet_col"}},{"for":{"in":"tooltips"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"########## Known Limitation of ggplotly ############\n# Ignore theme(legend.position)\n# Ignore geom_text(vjust, hjust)\n# Ignore facet_grid(space)\n# Does not support well title, subtitle, caption\n# need more margins for showing x y labels correctly\n####################################################\n\n\n############### Utility functions ###############\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\n}\n\nlibraryRequireInstall(\"XML\")\nlibraryRequireInstall(\"htmlwidgets\")\n\ninternalSaveWidget <- function(widget, fname)\n{\n  tempFname = paste(fname, \".tmp\", sep=\"\")\n  htmlwidgets::saveWidget(widget, file = tempFname, selfcontained = FALSE)\n  FlattenHTML(tempFname, fname)\n}\n\nFlattenHTML <- function(fnameIn, fnameOut)\n{\n  # Read and parse HTML file\n  # Embed all js and css files into one unified file\n  \n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = htmlTreeParse(fnameIn, useInternal = TRUE)\n  top = xmlRoot(html)\n  \n  # extract all <script> tags with src value\n  srcNode=getNodeSet(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(fname)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s) = 'src'\n      newNode = xmlNode(\"script\",attrs = s)\n      replaceNodes(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(fname);\n      if (!is.null(str))\n      {      \n        newNode = xmlNode(\"script\", str, attrs = c(type = \"text/javascript\"))\n        replaceNodes(node, newNode)\n      }\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=getNodeSet(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['href'])\n    str = ReadFileForEmbedding(fname, FALSE);\n    if (!is.null(str))\n    {\n      newNode = xmlNode(\"style\", str)\n      replaceNodes(node, newNode)\n    }\n  }\n  \n  saveXML(html, file = fnameOut)\n  return(TRUE)\n}\n\nReadFileForEmbedding <- function(fname, addCdata = TRUE)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  if (addCdata) {\n    str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  }\n  return(str)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n  \n  con = file(fname, open = \"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nFindSrcReplacement <- function(str)\n{\n  # finds reference to 'plotly' js and replaces with a version from CDN\n  # This allows the HTML to be smaller, since this script is not fully embedded in it\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotlyjs-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes') <- FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch) == 0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes') <- FALSE\n  strmatch = regmatches(strMatch[1], match2)\n  if (length(strmatch) == 0) return(NULL)\n  \n  # CDN url is https://cdn.plot.ly/plotly-<Version>.js\n  # This matches the specific version used in the plotly package used.\n  verstr = substr(strmatch, 2, nchar(strmatch)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n#################################################\n\n\n############### Library Declarations ###############\nlibraryRequireInstall(\"ggplot2\");\nlibraryRequireInstall(\"plotly\")\n#libraryRequireInstall(\"ggpmisc\")\n#libraryRequireInstall(\"tidyverse\")\n####################################################\n\nstat_smooth_func <- function(mapping = NULL, data = NULL,\r\n                        geom = \"smooth\", position = \"identity\",\r\n                        ...,\r\n                        method = \"auto\",\r\n                        formula = y ~ x,\r\n                        se = TRUE,\r\n                        n = 80,\r\n                        span = 0.75,\r\n                        fullrange = FALSE,\r\n                        level = 0.95,\r\n                        method.args = list(),\r\n                        na.rm = FALSE,\r\n                        show.legend = NA,\r\n                        inherit.aes = TRUE,\r\n                        xpos = NULL,\r\n                        ypos = NULL) {\r\n  layer(\r\n    data = data,\r\n    mapping = mapping,\r\n    stat = StatSmoothFunc,\r\n    geom = geom,\r\n    position = position,\r\n    show.legend = show.legend,\r\n    inherit.aes = inherit.aes,\r\n    params = list(\r\n      method = method,\r\n      formula = formula,\r\n      se = se,\r\n      n = n,\r\n      fullrange = fullrange,\r\n      level = level,\r\n      na.rm = na.rm,\r\n      method.args = method.args,\r\n      span = span,\r\n      xpos = xpos,\r\n      ypos = ypos,\r\n      ...\r\n    )\r\n  )\r\n}\r\n\r\n\r\nStatSmoothFunc <- ggproto(\"StatSmooth\", Stat,\r\n                      \r\n                      setup_params = function(data, params) {\r\n                        # Figure out what type of smoothing to do: loess for small datasets,\r\n                        # gam with a cubic regression basis for large data\r\n                        # This is based on the size of the _largest_ group.\r\n                        if (identical(params$method, \"auto\")) {\r\n                          max_group <- max(table(data$group))\r\n                          \r\n                          if (max_group < 1000) {\r\n                            params$method <- \"loess\"\r\n                          } else {\r\n                            params$method <- \"gam\"\r\n                            params$formula <- y ~ s(x, bs = \"cs\")\r\n                          }\r\n                        }\r\n                        if (identical(params$method, \"gam\")) {\r\n                          params$method <- mgcv::gam\r\n                        }\r\n                        \r\n                        params\r\n                      },\r\n                      \r\n                      compute_group = function(data, scales, method = \"auto\", formula = y~x,\r\n                                               se = TRUE, n = 80, span = 0.75, fullrange = FALSE,\r\n                                               xseq = NULL, level = 0.95, method.args = list(),\r\n                                               na.rm = FALSE, xpos=NULL, ypos=NULL) {\r\n                        if (length(unique(data$x)) < 2) {\r\n                          # Not enough data to perform fit\r\n                          return(data.frame())\r\n                        }\r\n                        \r\n                        if (is.null(data$weight)) data$weight <- 1\r\n                        \r\n                        if (is.null(xseq)) {\r\n                          if (is.integer(data$x)) {\r\n                            if (fullrange) {\r\n                              xseq <- scales$x$dimension()\r\n                            } else {\r\n                              xseq <- sort(unique(data$x))\r\n                            }\r\n                          } else {\r\n                            if (fullrange) {\r\n                              range <- scales$x$dimension()\r\n                            } else {\r\n                              range <- range(data$x, na.rm = TRUE)\r\n                            }\r\n                            xseq <- seq(range[1], range[2], length.out = n)\r\n                          }\r\n                        }\r\n                        # Special case span because it's the most commonly used model argument\r\n                        if (identical(method, \"loess\")) {\r\n                          method.args$span <- span\r\n                        }\r\n                        \r\n                        if (is.character(method)) method <- match.fun(method)\r\n                        \r\n                        base.args <- list(quote(formula), data = quote(data), weights = quote(weight))\r\n                        model <- do.call(method, c(base.args, method.args))\r\n                        \r\n                        m = model\r\n                        # eq <- substitute(italic(y) == a + b %.% italic(x)*\",\"~~italic(r)^2~\"=\"~r2, \r\n                        #                  list(a = format(coef(m)[[1]], digits = 3), \r\n                        #                       b = format(coef(m)[[2]], digits = 3), \r\n                        #                       r2 = format(summary(m)$r.squared, digits = 3)))\r\n                        # func_string = as.character(as.expression(eq))\r\n\r\n                        a = format(coef(m)[[1]], digits = 3)\r\n                        b = format(coef(m)[[2]], digits = 3)\r\n                        r2 = format(summary(m)$r.squared, digits = 3)\r\n\r\n                        func_string <- paste(\"<i>y</i> = \", a, \" + \", b, \" * <i>x</i>,  <i>r</i><sup>2</sup> = \", r2)\r\n\r\n                        group.idx <- abs(data$group[1])\r\n                        \r\n                        #if(is.null(xpos)) {\r\n                            x = (1 - xpos) * scales$x$dimension()[1] + xpos * scales$x$dimension()[2] #min(data$x)*0.9\r\n                            # hjust = 0\r\n                        #}\r\n                        #if(is.null(ypos)) {\r\n                            # ypos = scales$y$dimension()[2] #max(data$y)*0.9\r\n                            # vjust = 1.4 * group.idx\r\n\r\n                            y = (1 - ypos) * scales$y$dimension()[1] + ypos * scales$y$dimension()[2] - (group.idx - 1) * (scales$y$dimension()[2] - scales$y$dimension()[1]) * 0.2\r\n                        #}\r\n                        data.frame(x=x, y=y, label=func_string) #, hjust = hjust, vjust = vjust)\r\n                        \r\n                      },\r\n                      \r\n                      required_aes = c(\"x\", \"y\")\r\n)\r\n\n\n################### Actual code ####################\n\n#PBI_PARAM fitting of scatterplot points\n#Type:bool, Default:TRUE, Range:NA, PossibleValues:NA, Remarks: NA\n\nsaving = FALSE\nif(exists(\"settings_saving_params_show\")){\n  saving = settings_saving_params_show\n}\n\n# saving_filename = \"figure.html\"\n# if(exists(\"settings_saving_params_filename\")){\n#   saving_filename = settings_saving_params_filename\n# }\n\nfitting = TRUE\nif(exists(\"settings_fitting_params_show\")){\n  fitting = settings_fitting_params_show\n}\n\nfitting_equation = TRUE\nif(exists(\"settings_fitting_params_equation\")){\n  fitting_equation = settings_fitting_params_equation\n}\n\nfitting_equationsize = 3\nif(exists(\"settings_fitting_params_equationsize\")){\n  fitting_equationsize = settings_fitting_params_equationsize\n}\n\nfitting_equationx = 0.75\nif(exists(\"settings_fitting_params_equationx\")){\n  fitting_equationx = min(max(settings_fitting_params_equationx, 0), 1)\n}\n\nfitting_equationy = 1\nif(exists(\"settings_fitting_params_equationy\")){\n  fitting_equationy = min(max(settings_fitting_params_equationy, 0), 1)\n}\n\nfitting_lineWidth = 1\nif(exists(\"settings_fitting_params_lineWidth\")){\n  fitting_lineWidth = settings_fitting_params_lineWidth\n}\n\nfitting_se = TRUE\nif(exists(\"settings_fitting_params_se\")){\n  fitting_se = settings_fitting_params_se\n}\n\nfitting_level = 0.95\nif(exists(\"settings_fitting_params_level\")){\n  fitting_level = as.numeric(settings_fitting_params_level)\n}\n\nscatter_size = 1\nif(exists(\"settings_scatter_params_size\")){\n  scatter_size = as.numeric(settings_scatter_params_size)\n}\n\nscatter_alpha = 1\nif(exists(\"settings_scatter_params_opacity\")){\n  scatter_alpha = as.numeric(settings_scatter_params_opacity)/100\n}\n\nxaxis_factor = FALSE\nif (exists(\"settings_xaxis_params_factor\")) {\n  xaxis_factor = settings_xaxis_params_factor\n}\n\nxaxis_xstart = NA_real_\nif (exists(\"settings_xaxis_params_xstart\")) {\n  xaxis_xstart = settings_xaxis_params_xstart\n}\n\nxaxis_xend = NA_real_\nif (exists(\"settings_xaxis_params_xend\")) {\n  xaxis_xend = settings_xaxis_params_xend\n}\n\nxaxis_xtitle = \"\"\nif (exists(\"settings_xaxis_params_xtitle\")) {\n  xaxis_xtitle = settings_xaxis_params_xtitle\n}\n\nxaxis_xtitlesize = NULL\nif (exists(\"settings_xaxis_params_xtitlesize\")) {\n  xaxis_xtitlesize = settings_xaxis_params_xtitlesize\n}\n\nxaxis_xtextsize = NULL\nif (exists(\"settings_xaxis_params_xtextsize\")) {\n  xaxis_xtextsize = settings_xaxis_params_xtextsize\n}\n\nyaxis_factor = FALSE\nif (exists(\"settings_yaxis_params_factor\")) {\n  yaxis_factor = settings_yaxis_params_factor\n}\n\nyaxis_ystart = NA_real_\nif (exists(\"settings_yaxis_params_ystart\")) {\n  yaxis_ystart = settings_yaxis_params_ystart\n}\n\nyaxis_yend = NA_real_\nif (exists(\"settings_yaxis_params_yend\")) {\n  yaxis_yend = settings_yaxis_params_yend\n}\n\nyaxis_ytitle = \"\"\nif (exists(\"settings_yaxis_params_ytitle\")) {\n  yaxis_ytitle = settings_yaxis_params_ytitle\n}\n\nyaxis_ytitlesize = NULL\nif (exists(\"settings_yaxis_params_ytitlesize\")) {\n  yaxis_ytitlesize = settings_yaxis_params_ytitlesize\n}\n\nyaxis_ytextsize = NULL\nif (exists(\"settings_yaxis_params_ytextsize\")) {\n  yaxis_ytextsize = settings_yaxis_params_ytextsize\n}\n\nlegend_factor = TRUE\nif (exists(\"settings_legend_params_factor\")) {\n  legend_factor = settings_legend_params_factor\n}\n\nlegend_colortitle = \"\"\nif (exists(\"settings_legend_params_colortitle\")) {\n  legend_colortitle = settings_legend_params_colortitle\n}\n\nlegend_colortitlesize = NULL\nif (exists(\"settings_legend_params_colortitlesize\")) {\n  legend_colortitlesize = settings_legend_params_colortitlesize\n}\n\nlegend_colortextsize = NULL\nif (exists(\"settings_legend_params_colortextsize\")) {\n  legend_colortextsize = settings_legend_params_colortextsize\n}\n\n# legend_orientation = \"h\"\n# if (exists(\"settings_legend_params_orientation\")) {\n#   legend_orientation = settings_legend_params_orientation\n# }\n\nfacetgrid_scales = \"fixed\"\nif (exists(\"settings_facetgrid_params_scales\")) {\n  facetgrid_scales = settings_facetgrid_params_scales\n}\n\nfacetgrid_space = \"fixed\"\nif (exists(\"settings_facetgrid_params_space\")) {\n  facetgrid_space = settings_facetgrid_params_space\n}\n\nfacetgrid_labeller = \"label_both\"\nif (exists(\"settings_facetgrid_params_labeller\")) {\n  facetgrid_labeller = settings_facetgrid_params_labeller\n}\n\nfacetgrid_horizontaltextsize = NULL\nif (exists(\"settings_facetgrid_params_horizontaltextsize\")) {\n  facetgrid_horizontaltextsize = settings_facetgrid_params_horizontaltextsize\n}\n\nfacetgrid_verticaltextsize = NULL\nif (exists(\"settings_facetgrid_params_verticaltextsize\")) {\n  facetgrid_verticaltextsize = settings_facetgrid_params_verticaltextsize\n}\n\ntitle_title = \"\"\nif (exists(\"settings_title_params_title\")) {\n  title_title = settings_title_params_title\n}\n\ntitle_fontsize = NULL\nif (exists(\"settings_title_params_fontsize\")) {\n  title_fontsize = settings_title_params_fontsize\n}\n\ntheme_theme = \"gray\"\nif (exists(\"settings_theme_params_theme\")) {\n  theme_theme = settings_theme_params_theme\n}\n\n\n\nif (xaxis_factor) {\n  x[[1]] <- factor(x[[1]])\n}\n\nif (yaxis_factor) {\n  y[[1]] <- factor(y[[1]])\n}\n\nx_colname <- colnames(x)[[1]]\ny_colname <- colnames(y)[[1]]\nx_colname <- paste0(\"`\", x_colname, \"`\")\ny_colname <- paste0(\"`\", y_colname, \"`\")\n\ncolor_colname <- NULL\nfacet_row_colname <- \".\"\nfacet_col_colname <- \".\"\n\ndataset <- cbind(x, y)\n\nif (exists(\"yerror\")) {\n  ymin <- data.frame(ymin = y[[1]] - yerror[[1]])\n  ymax <- data.frame(ymax = y[[1]] + yerror[[1]]) \n  dataset <- cbind(dataset, ymin, ymax)\n}\n\nif(exists(\"color\"))\n  { if (legend_factor) {\n      color[[1]] <- factor(color[[1]])\n    }\n    dataset <- cbind(dataset, color)\n    color_colname <- colnames(color)[[1]]\n    color_colname <- paste0(\"`\", color_colname, \"`\")\n  } else {\n    scatter_color = \"blue\"\n    if(exists(\"settings_scatter_params_color\")){\n      scatter_color = settings_scatter_params_color\n    }   \n  }\n\nif(exists(\"facet_row\"))\n  {\n    dataset <- cbind(dataset, facet_row)\n    facet_row_colname <- colnames(facet_row)#[[1]]\n    #facet_row_colname <- paste(facet_row_colname, sep = \"+\")\n    facet_row_colname <- paste(paste0(\"`\", facet_row_colname, \"`\"), collapse = \"+\")\n  }\n\nif(exists(\"facet_col\"))\n  {\n    dataset <- cbind(dataset, facet_col)\n    facet_col_colname <- colnames(facet_col)#[[1]]\n    facet_col_colname <- paste(paste0(\"`\", facet_col_colname, \"`\"), collapse = \"+\")\n  }\n\np <- ggplot(data = dataset, \n            mapping = aes_string(\n                x_colname, \n                y_colname, \n                color = color_colname)) \n\nif(exists(\"color\")) {\n  p <- p + geom_point(size = scatter_size, \n                      alpha = scatter_alpha)\n} else {\n  p <- p + geom_point(size = scatter_size, \n                      alpha = scatter_alpha,\n                      color = scatter_color)\n}\n\nif (exists(\"yerror\")) {\n  p <- p + geom_errorbar(aes(ymin = ymin, ymax = ymax))\n}\n\nif (fitting) {\n  formula <- y ~ x\n  p <- p + geom_smooth(method = \"lm\", \n                        size = fitting_lineWidth, \n                        se = fitting_se, \n                        level = fitting_level) \n\n  if (fitting_equation) {\n    p <- p +\n      #stat_poly_eq(aes(label = ..eq.label..), formula = formula, parse = FALSE)\n      stat_smooth_func(geom=\"text\", method=\"lm\", formula = y ~ x, parse=TRUE, \n                        size = fitting_equationsize,\n                        xpos = fitting_equationx, \n                        ypos = fitting_equationy)\n  }\n\n}\n\nif (exists(\"facet_row\") | exists(\"facet_col\")) {\n  p <- p + facet_grid(#reformulate(facet_col_colname, facet_row_colname),\n                      as.formula(paste(facet_row_colname, \"~\", facet_col_colname)),\n                      scales = facetgrid_scales,\n                      space = facetgrid_space,\n                      labeller = facetgrid_labeller) # the formula generated is \"facet_row_colname ~ facet_col_colname\"\n}\n\nif (!xaxis_factor) {\n  p <- p + \n    xlim(xaxis_xstart, xaxis_xend)\n}\n\nif (!yaxis_factor) {\n  p <- p + \n    ylim(yaxis_ystart, yaxis_yend)\n}\n\nif (xaxis_xtitle != \"\") {\n  p <- p + xlab(xaxis_xtitle)\n}\n\nif (yaxis_ytitle != \"\") {\n  p <- p + ylab(yaxis_ytitle)\n}\n\nif (legend_colortitle != \"\") {\n  p <- p + labs(color = legend_colortitle)\n}\n\nif (theme_theme == \"gray\") {\n  p <- p + theme_gray()\n}\n\nif (theme_theme == \"bw\") {\n  p <- p + theme_bw()\n}\n\nif (theme_theme == \"linedraw\") {\n  p <- p + theme_linedraw()\n}\n\nif (theme_theme == \"light\") {\n  p <- p + theme_light()\n}\n\nif (theme_theme == \"dark\") {\n  p <- p + theme_dark()\n}\n\nif (theme_theme == \"minimal\") {\n  p <- p + theme_minimal()\n}\n\nif (theme_theme == \"classic\") {\n  p <- p + theme_classic()\n}\n\nif (theme_theme == \"void\") {\n  p <- p + theme_void()\n}\n\n\np <- p + \n  theme(axis.title.x = element_text(size = xaxis_xtitlesize),\n        axis.text.x = element_text(size = xaxis_xtextsize),\n        axis.title.y = element_text(size = yaxis_ytitlesize),\n        axis.text.y = element_text(size = yaxis_ytextsize),\n        legend.title = element_text(size = legend_colortitlesize),\n        legend.text = element_text(size = legend_colortextsize),\n        strip.text.x = element_text(size = facetgrid_horizontaltextsize),\n        strip.text.y = element_text(size = facetgrid_verticaltextsize))\n\n\n#p <- p + theme(legend.position = legend_position)\n\n####################################################\n\n############# Create and save widget ###############\np <- ggplotly(p) %>%\n  layout(margin = list(l = 100, t = 50))\n\nif (title_title != \"\") {\n  p <- p %>%\n    layout(title = list(text = title_title, y = 1))\n}\n\np <- p %>%\n  layout(title = list(font = list(size = title_fontsize)))\n\n#p <- p %>% toWebGL()\nif (!saving) {\n  internalSaveWidget(p, 'out.html')\n} else {\n  htmlwidgets::saveWidget(p, \"out.html\", selfcontained = TRUE)\n  filename <- file.choose()\n  filename <- paste0(gsub(\".html\", \"\", filename, ignore.case=T), \"_pBIplotly.html\")\n  file.copy(\"out.html\", filename, overwrite = TRUE, recursive = FALSE,\n          copy.mode = TRUE, copy.date = FALSE)\n}\n\n\n####################################################\n"}}}],"objects":{"settings_saving_params":{"displayName":"Save Interactive Visual","description":"Save Interactive Visual settings","properties":{"show":{"displayName":"Save Interactive Visual","description":"Save Interactive Visual description.","type":{"bool":true}}}},"settings_fitting_params":{"displayName":"Fitting","description":"Fitting settings","properties":{"show":{"displayName":"Fitting","description":"Fitting description.","type":{"bool":true}},"equation":{"displayName":"Equation","description":"Equation description.","type":{"bool":true}},"equationsize":{"displayName":"Equation Size","description":"Equation Size description.","type":{"numeric":true}},"equationx":{"displayName":"Equation x position","description":"Equation x position description.","type":{"numeric":true}},"equationy":{"displayName":"Equation y position","description":"Equation y position description.","type":{"numeric":true}},"lineWidth":{"displayName":"Line width","description":"Line width description.","type":{"numeric":true}},"se":{"displayName":"Standard Error","description":"Standard Error description.","type":{"bool":true}},"level":{"displayName":"Confidence Interval level","description":"Confidence Interval level description.","type":{"enumeration":[{"displayName":"0.95","value":"0.95"},{"displayName":"0.9","value":"0.9"}]}}}},"settings_scatter_params":{"displayName":"Scatter","description":"Scatter settings","properties":{"size":{"displayName":"Size","description":"Size description.","type":{"numeric":true}},"color":{"displayName":"Color","description":"Color settings","type":{"fill":{"solid":{"color":true}}}},"opacity":{"displayName":"Opacity","description":"Opacity description.","type":{"numeric":true}}}},"settings_xaxis_params":{"displayName":"x axis","description":"x axis settings","properties":{"factor":{"displayName":"Factor","description":"Factor description.","type":{"bool":true}},"xstart":{"displayName":"x start","description":"x start description.","type":{"numeric":true}},"xend":{"displayName":"x end","description":"x end description.","type":{"numeric":true}},"xtitle":{"displayName":"x title","description":"x title description.","type":{"text":true}},"xtitlesize":{"displayName":"x title size","description":"x title size description.","type":{"numeric":true}},"xtextsize":{"displayName":"x text size","description":"x text size description.","type":{"numeric":true}}}},"settings_yaxis_params":{"displayName":"y axis","description":"y axis settings","properties":{"factor":{"displayName":"Factor","description":"Factor description.","type":{"bool":true}},"ystart":{"displayName":"y start","description":"y start description.","type":{"numeric":true}},"yend":{"displayName":"y end","description":"y end description.","type":{"numeric":true}},"ytitle":{"displayName":"y title","description":"y title description.","type":{"text":true}},"ytitlesize":{"displayName":"y title size","description":"y title size description.","type":{"numeric":true}},"ytextsize":{"displayName":"y text size","description":"y text size description.","type":{"numeric":true}}}},"settings_legend_params":{"displayName":"Legend","description":"Legend settings","properties":{"factor":{"displayName":"Factor","description":"Factor description.","type":{"bool":true}},"colortitle":{"displayName":"color title","description":"color title description.","type":{"text":true}},"colortitlesize":{"displayName":"color title size","description":"color title size description.","type":{"numeric":true}},"colortextsize":{"displayName":"color text size","description":"color text size description.","type":{"numeric":true}}}},"settings_facetgrid_params":{"displayName":"Facet Grid","description":"Facet Grid settings","properties":{"scales":{"displayName":"Scales","description":"Scales description.","type":{"enumeration":[{"displayName":"fixed","value":"fixed"},{"displayName":"free_x","value":"free_x"},{"displayName":"free_y","value":"free_y"},{"displayName":"free","value":"free"}]}},"space":{"displayName":"Space","description":"Space description.","type":{"enumeration":[{"displayName":"fixed","value":"fixed"},{"displayName":"free_x","value":"free_x"},{"displayName":"free_y","value":"free_y"},{"displayName":"free","value":"free"}]}},"labeller":{"displayName":"Labeller","description":"Labeller description.","type":{"enumeration":[{"displayName":"label_both","value":"label_both"},{"displayName":"label_value","value":"label_value"}]}},"horizontaltextsize":{"displayName":"horizontal text size","description":"horizontal text size description.","type":{"numeric":true}},"verticaltextsize":{"displayName":"vertical text size","description":"vertical text size description.","type":{"numeric":true}}}},"settings_title_params":{"displayName":"Title","description":"Title settings","properties":{"title":{"displayName":"title","description":"title description.","type":{"text":true}},"fontsize":{"displayName":"font size","description":"font size description.","type":{"numeric":true}}}},"settings_theme_params":{"displayName":"Theme","description":"Theme settings","properties":{"theme":{"displayName":"theme","description":"theme description.","type":{"enumeration":[{"displayName":"gray","value":"gray"},{"displayName":"bw","value":"bw"},{"displayName":"linedraw","value":"linedraw"},{"displayName":"light","value":"light"},{"displayName":"dark","value":"dark"},{"displayName":"minimal","value":"minimal"},{"displayName":"classic","value":"classic"},{"displayName":"void","value":"void"}]}}}},"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"plotly","displayName":"Plotly","url":"https://cran.r-project.org/web/packages/plotly/index.html"},{"name":"htmlwidgets","displayName":"HTML Widgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"},{"name":"XML","displayName":"XML","url":"https://cran.r-project.org/web/packages/XML/index.html"}]},"stringResources":{},"content":{"js":"var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e,n){void 0===t&&(t=[]);var r=t;return i(r),e&&(r.identityFields=e),n&&(r.source=n),r}function i(t,e){t.grouped=e?function(){return e}:function(){return n(t)}}function n(t){for(var e,i=[],n=0,r=t.length;r>n;n++){var a=t[n];if(!e||e.identity!==a.identity){if(e={values:[]},a.identity){e.identity=a.identity;var o=a.source;void 0!==o.groupName?e.name=o.groupName:o.displayName&&(e.name=o.displayName)}i.push(e)}e.values.push(a)}return i}t.createValueColumns=e,t.setGrouped=i,t.groupValues=n}(e=t.DataViewTransform||(t.DataViewTransform={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e){if(!t||!t.length)return-1;var i=t[0];if(i.values&&i.values.length>0)for(var r=0,a=i.values.length;a>r;++r){var o=i.values[r];if(o&&o.source&&n(o.source,e))return r}return-1}function i(t,e){if(t&&t.length)for(var i=0,r=t.length;r>i;i++)if(n(t[i].source,e))return i;return-1}function n(t,e){var i=t.roles;return i&&i[e]}function r(t,e){return null!=t&&null!=t.metadata&&t.metadata.columns&&t.metadata.columns.some(function(t){return t.roles&&void 0!==t.roles[e]})}function a(t,e){return t&&t.source&&t.source.roles&&t.source.roles[e]===!0}t.getMeasureIndexOfRole=e,t.getCategoryIndexOfRole=i,t.hasRole=n,t.hasRoleInDataView=r,t.hasRoleInValueColumn=a}(e=t.DataRoleHelper||(t.DataRoleHelper={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e,i){if(!t)return i;var n=t[e];return void 0===n?i:n}function i(t,i,n){var r=e(t,i);return r&&r.solid?r.solid.color:n}t.getValue=e,t.getFillColorByPropertyName=i}(e=t.DataViewObject||(t.DataViewObject={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(e){function i(e,i,n){return e?t.DataViewObject.getValue(e[i.objectName],i.propertyName,n):n}function n(t,e,i){return t&&t[e]?t[e]:i}function r(t,e,n){var r=i(t,e);return r&&r.solid?r.solid.color:n}function a(t,e,n){var r=i(t,e,n);return r&&r.solid?r.solid.color:void 0===r||null===r||\"object\"==typeof r&&!r.solid?n:r}e.getValue=i,e.getObject=n,e.getFillColor=r,e.getCommonValue=a}(e=t.DataViewObjects||(t.DataViewObjects={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i,n=t.extensibility.utils.dataview.DataRoleHelper;!function(t){function e(t,e,i){if(t.categories&&t.categories.length>0){var r=t.categories[0];return r.source&&n.hasRole(r.source,e)&&n.hasRole(r.source,i)}return!1}function i(t){return void 0!==t.groupName?t.groupName:t.queryName}function r(t){var e=o(t);return null!=e&&e.imageUrl===!0}function a(t){var e=o(t);return null!=e&&e.webUrl===!0}function o(t){return t&&t.type&&t.type.misc}function s(t){return t&&t.metadata&&t.metadata.columns&&t.metadata.columns.length?t.metadata.columns.some(function(t){return r(t)===!0}):!1}t.categoryIsAlsoSeriesRole=e,t.getSeriesName=i,t.isImageUrlColumn=r,t.isWebUrlColumn=a,t.getMiscellaneousTypeDescriptor=o,t.hasImageUrlColumn=s}(i=e.converterHelper||(e.converterHelper={}))}(i=e.dataview||(e.dataview={}))}(i=e.utils||(e.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){}return e.getDefault=function(){return new this},e.createPropertyIdentifier=function(t,e){return{objectName:t,propertyName:e}},e.parse=function(e){var i,n=this.getDefault();if(!e||!e.metadata||!e.metadata.objects)return n;i=n.getProperties();for(var r in i)for(var a in i[r]){var o=n[r][a];n[r][a]=t.DataViewObjects.getCommonValue(e.metadata.objects,i[r][a],o)}return n},e.isPropertyEnumerable=function(t){return!e.InnumerablePropertyPrefix.test(t)},e.enumerateObjectInstances=function(t,e){var i=t&&t[e.objectName];if(!i)return[];var n={objectName:e.objectName,selector:null,properties:{}};for(var r in i)i.hasOwnProperty(r)&&(n.properties[r]=i[r]);return{instances:[n]}},e.prototype.getProperties=function(){var t=this,i={},n=Object.keys(this);return n.forEach(function(n){if(e.isPropertyEnumerable(n)){var r=Object.keys(t[n]);i[n]={},r.forEach(function(t){e.isPropertyEnumerable(n)&&(i[n][t]=e.createPropertyIdentifier(n,t))})}}),i},e}();e.InnumerablePropertyPrefix=/^_/,t.DataViewObjectsParser=e}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){\"use strict\";function e(){o=0}function i(){return 0===o}function n(t,e){var i=[];if(t&&t.hasChildNodes()){for(var n=t.children,a=0;a<n.length;a++){var o=void 0;o=\"script\"===n.item(a).nodeName.toLowerCase()?r(n.item(a)):n.item(a).cloneNode(!0),e.appendChild(o),i.push(o)}return i}}function r(t){for(var e=document.createElement(\"script\"),i=t.attributes,n=0;n<i.length;n++)e.setAttribute(i[n].name,i[n].textContent),\"src\"===i[n].name.toLowerCase()&&(o++,e.onload=function(){o--});return e.innerHTML=t.innerHTML,e}function a(){var t=window.setInterval(function(){i()&&(window.clearInterval(t),window.hasOwnProperty(\"HTMLWidgets\")&&window.HTMLWidgets.staticRender&&window.HTMLWidgets.staticRender())},100)}var o=0;t.ResetInjector=e,t.injectorReady=i,t.ParseElement=n,t.RunHTMLWidgetRenderer=a}(e=t.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B||(t.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B={}))}(e=t.visual||(t.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){\"use strict\";var i=t.extensibility.utils.dataview.DataViewObjectsParser,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rcv_script=new r,e.settings_saving_params=new a,e.settings_fitting_params=new o,e.settings_scatter_params=new s,e.settings_xaxis_params=new u,e.settings_yaxis_params=new l,e.settings_legend_params=new c,e.settings_facetgrid_params=new f,e.settings_title_params=new p,e.settings_theme_params=new v,e}return __extends(e,t),e}(i);e.VisualSettings=n;var r=function(){function t(){}return t}();e.rcv_scriptSettings=r;var a=function(){function t(){this.show=!1}return t}();e.settings_saving_params=a;var o=function(){function t(){this.show=!0,this.equation=!0,this.equationsize=3,this.equationx=.75,this.equationy=1,this.lineWidth=1,this.se=!0,this.level=\"0.95\"}return t}();e.settings_fitting_params=o;var s=function(){function t(){this.size=1,this.color=\"orange\",this.opacity=100}return t}();e.settings_scatter_params=s;var u=function(){function t(){this.factor=!1,this.xstart=null,this.xend=null,this.xtitle=\"\",this.xtitlesize=null,this.xtextsize=null}return t}();e.settings_xaxis_params=u;var l=function(){function t(){this.factor=!1,this.ystart=null,this.yend=null,this.ytitle=\"\",this.ytitlesize=null,this.ytextsize=null}return t}();e.settings_yaxis_params=l;var c=function(){function t(){this.factor=!0,this.colortitle=\"\",this.colortitlesize=null,this.colortextsize=null}return t}();e.settings_legend_params=c;var f=function(){function t(){this.scales=\"fixed\",this.space=\"fixed\",this.labeller=\"label_both\",this.horizontaltextsize=null,this.verticaltextsize=null}return t}();e.settings_facetgrid_params=f;var p=function(){function t(){this.title=\"\",this.fontsize=null}return t}();e.settings_title_params=p;var v=function(){function t(){this.theme=\"gray\"}return t}();e.settings_theme_params=v}(i=e.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B||(e.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B={}))}(i=e.visual||(e.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){\"use strict\";var i=!1,n=[t.VisualUpdateType.Resize,t.VisualUpdateType.ResizeEnd,t.VisualUpdateType.Resize+t.VisualUpdateType.ResizeEnd],r=function(){function t(t){t&&t.element&&(this.rootElement=t.element),this.headNodes=[],this.bodyNodes=[]}return t.prototype.update=function(e){if(e&&e.type&&e.viewport&&e.dataViews&&0!==e.dataViews.length&&e.dataViews[0]){var i=e.dataViews[0];this.settings=t.parseSettings(i);var r=null;i.scriptResult&&i.scriptResult.payloadBase64&&(r=i.scriptResult.payloadBase64),-1===n.indexOf(e.type)?r&&this.injectCodeFromPayload(r):this.onResizing(e.viewport)}},t.prototype.onResizing=function(t){},t.prototype.injectCodeFromPayload=function(t){if(e.ResetInjector(),t){var n=document.createElement(\"html\");try{n.innerHTML=window.atob(t)}catch(r){return}if(i||0===this.headNodes.length){for(;this.headNodes.length>0;){var a=this.headNodes.pop();document.head.removeChild(a)}var o=n.getElementsByTagName(\"head\");if(o&&o.length>0){var s=o[0];this.headNodes=e.ParseElement(s,document.head)}}for(;this.bodyNodes.length>0;){var a=this.bodyNodes.pop();this.rootElement.removeChild(a)}var u=n.getElementsByTagName(\"body\");if(u&&u.length>0){var l=u[0];this.bodyNodes=e.ParseElement(l,this.rootElement)}e.RunHTMLWidgetRenderer()}},t.parseSettings=function(t){return e.VisualSettings.parse(t)},t.prototype.enumerateObjectInstances=function(t){return e.VisualSettings.enumerateObjectInstances(this.settings||e.VisualSettings.getDefault(),t)},t}();e.Visual=r}(i=e.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B||(e.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B={}))}(i=e.visual||(e.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){e.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B={name:\"pBIplotlyAFEA9760BDCA4473BEA802445EC7558B\",displayName:\"PBI_plotly\",\"class\":\"Visual\",version:\"1.0.0\",apiVersion:\"2.5.0\",create:function(e){return new t.extensibility.visual.pBIplotlyAFEA9760BDCA4473BEA802445EC7558B.Visual(e)},custom:!0}}(i=e.plugins||(e.plugins={}))}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={}));","css":".visual-pBIplotlyAFEA9760BDCA4473BEA802445EC7558B .rcv_autoScaleImageContainer{position:relative}.visual-pBIplotlyAFEA9760BDCA4473BEA802445EC7558B .rcv_autoScaleImageContainer .rcv_autoScaleImage{max-width:100%;max-height:100%;position:absolute;top:50%;left:50%;transform:translateY(-50%) translateX(-50%);-webkit-transform:translateY(-50%) translateX(-50%)}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAB1ElEQVR42rWTzUsbURTF8y84H8bERHEEpbgQ3Sio0NJFwYXgwlLdWHCtUrpwpStXIoIrV8kkJjWJSdTEVokSJX5gWypGbVFQkRYVREQFxWqdd3zXFKMwKgkIZ3G57/7m3PNmxhD5g9Y5NM+mppZZeDZgaJpGhi0dvRyB4f1UmnDF8F3YDtkL0UW12E+1YKem5IHopqbghOSDoOrBkh/KvmZZZBzI/sqUA00eIjJvV8tZZZwxx5hyqGWG9WDxEyyrLCtKsHGCWX8x8nTBEmemmZvmF2ZdY9xDb20ulfZMRLhdL7H8/1p9ILPQD/McM45S/SqEj/PIc1NOU4wZx8m5PIi2BRQM6MFyAMqRZl1hooq+nzi+QPVnSF7w8DnrlLnzB87+oX5S11mFHKZp0Q7bGk4vUTNGQeQQpEEa6FrCxRUao7qwHflumBz3YMEGxY1s51NwsQ/Tu2j/BllNwoUDGPuN7jgy1Ufh1yEc/UVgC1mOJFwWwN4Zojtk/igc1oODBE89L1w1THOOdYrXu4KDc7wZRckgNk8Q2qaL7PhO768uogfz47cRCsnrUj/eTcDihFFF7Tg9l197kRcNk8h1PfR5pv9LpqhKDvcs0z4vPCnrwzyuAUD/AKnW1wZBAAAAAElFTkSuQmCC"}}